<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Token Price</title>
</head>

<body>
    <h1>ğŸ“ˆ Theo dÃµi giÃ¡ Token Real-time</h1>

    <label for="chain">Chá»n Blockchain:</label>
    <select id="chain">
        <option value="solana">Solana</option>
        <option value="ethereum">Ethereum</option>
        <option value="bsc">BSC</option>
        <option value="polygon">Polygon</option>
    </select>

    <label for="token">Nháº­p Token Address:</label>
    <input type="text" id="token" placeholder="Nháº­p Ä‘á»‹a chá»‰ token" />
    <button onclick="startTracking()">ğŸ” Theo dÃµi</button>

    <h2>ğŸ’° GiÃ¡ Token:</h2>
    <p id="price_usd">USD: Äang táº£i...</p>
    <p id="price_native">Native: Äang táº£i...</p>

    <script>
        let socket = null;

        function startTracking() {
            const chain = document.getElementById("chain").value;
            const tokenAddress = document.getElementById("token").value.trim();

            if (!tokenAddress) {
                alert("Vui lÃ²ng nháº­p Ä‘á»‹a chá»‰ token!");
                return;
            }

            // ÄÃ³ng káº¿t ná»‘i cÅ© náº¿u cÃ³
            if (socket) {
                socket.close();
            }

            // Táº¡o WebSocket káº¿t ná»‘i má»›i
            const wsUrl = `ws://127.0.0.1:8000/ws/price/${chain}/${tokenAddress}`;
            socket = new WebSocket(wsUrl);

            socket.onopen = function () {
                console.log("âœ… WebSocket Ä‘Ã£ káº¿t ná»‘i!");
            };

            socket.onmessage = function (event) {
                const data = JSON.parse(event.data);
                console.log("ğŸ’° Cáº­p nháº­t giÃ¡:", data);
                document.getElementById("price_usd").innerText = `USD: ${data.price_usd}`;
                document.getElementById("price_native").innerText = `Native: ${data.price_native}`;
            };

            socket.onclose = function () {
                console.log("âŒ Káº¿t ná»‘i WebSocket Ä‘Ã£ Ä‘Ã³ng.");
            };
        }
    </script>
</body>

</html>